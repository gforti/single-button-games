<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Overlap Game</title>
    <!-- Load Tailwind CSS for simple styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Tone.js for audio effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        /* Apply a festive font and ensure full viewport coverage */
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap');
        :root {
            --primary-red: #cc0000;
            --primary-green: #008000;
        }
        body {
            font-family: 'Luckiest Guy', cursive;
            background-color: #f7f7f7;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Game Container Styles */
        #game-container {
            position: relative;
            width: 90vw; /* Responsive width */
            max-width: 400px; /* Max width for desktop */
            aspect-ratio: 1 / 1; /* Keep it square */
            background-color: #ffffff;
            border: 8px solid var(--primary-red);
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        /* Moving Word Styles */
        .word {
            position: absolute;
            font-size: 2rem; /* Adjusted font size for "CHRISTMAS" */
            font-weight: bold;
            line-height: 1;
            padding: 5px;
            text-shadow: 2px 2px 0 #000;
            user-select: none;
            cursor: pointer;
            will-change: transform; /* Performance boost for animation */
            white-space: nowrap;
        }

        /* Horizontal word (Moves Left/Right, Centered Vertically) */
        #word-h {
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-green);
        }

        /* Vertical word (Moves Up/Down, Centered Horizontally) - No rotation now */
        #word-v {
            left: 50%;
            transform: translateX(-50%); /* Center horizontally, no rotation */
            color: var(--primary-red);
        }

        /* Button Styling */
        #stop-button {
            transition: all 0.15s ease;
            box-shadow: 0 6px 0 var(--primary-green);
        }
        #stop-button:active {
            box-shadow: 0 2px 0 var(--primary-green);
            transform: translateY(4px);
        }

        /* Result Display */
        #result-display {
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }
        .show-result {
            opacity: 1 !important;
        }
        
        /* --- Confetti Styles --- */
        #confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 10;
        }
        
        .confetto {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #ffcc00; /* Gold */
            border-radius: 50%;
            opacity: 0;
            animation: confetti-fall 3s ease-in forwards;
        }
        
        .c-red { background-color: var(--primary-red); }
        .c-green { background-color: var(--primary-green); }
        .c-white { background-color: #ffffff; border: 1px solid #ddd; }

        @keyframes confetti-fall {
            0% { opacity: 1; transform: translateY(-10vh) rotate(0deg); }
            100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
        }

        /* Media Query for larger screens */
        @media (min-width: 640px) {
            .word {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body class="bg-gray-900 flex flex-col p-4">

    <h1 class="text-4xl sm:text-5xl mb-6 text-yellow-300 drop-shadow-lg text-center">
        üéÑ Christmas Overlap üéÅ
    </h1>

    <div id="game-container">
        <!-- Confetti container must be inside game-container for localized effect -->
        <div id="confetti-container"></div>
        
        <!-- Horizontal Moving Word -->
        <div id="word-h" class="word">CHRISTMAS</div>

        <!-- Vertical Moving Word -->
        <div id="word-v" class="word">CHRISTMAS</div>

        <!-- Result/Message Overlay -->
        <div id="result-display" class="absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center show-result">
            <div class="p-6 text-center rounded-xl border-4 border-white transform scale-90">
                <p id="result-message" class="text-white text-3xl sm:text-4xl mb-4 leading-snug">Press START to begin!</p>
                <p id="overlap-text" class="text-xl text-yellow-300">Target Overlap: > 90%</p>
            </div>
        </div>
    </div>

    <!-- Controls and Score -->
    <div class="mt-8 flex flex-col items-center w-full max-w-sm mx-auto">
        <button id="stop-button"
                class="w-full py-4 text-3xl rounded-xl text-white bg-red-600 hover:bg-red-700 active:bg-red-800 border-b-4 border-red-800 mb-4 transition-all duration-150 shadow-xl"
                ontouchstart="this.classList.add('active')" ontouchend="this.classList.remove('active')">
            START
        </button>

        <div id="score-display" class="text-xl text-white mt-4 p-3 bg-gray-800 rounded-lg shadow-inner w-full text-center">
            Overlap: 0.00%
        </div>
    </div>


    <script>
        // --- GAME VARIABLES ---
        const gameContainer = document.getElementById('game-container');
        const wordH = document.getElementById('word-h');
        const wordV = document.getElementById('word-v');
        const stopButton = document.getElementById('stop-button');
        const resultDisplay = document.getElementById('result-display');
        const resultMessage = document.getElementById('result-message');
        const scoreDisplay = document.getElementById('score-display');
        const confettiContainer = document.getElementById('confetti-container');

        let isGameRunning = false;
        let isMoving = false;
        let animationFrameId = null;

        // Position and speed state
        let posH = 0; // Horizontal word x position (relative to container width)
        let posV = 0; // Vertical word y position (relative to container height)
        const speed = 0.003; 
        
        // --- AUDIO SETUP (Tone.js) ---
        // Initialize a simple synth
        const synth = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: "square" },
            envelope: { release: 0.1 }
        }).toDestination();

        let audioContextStarted = false;

        function startAudioContext() {
            if (!audioContextStarted) {
                Tone.start();
                audioContextStarted = true;
                // Play a quiet, high-frequency sound to confirm
                synth.triggerAttackRelease("C6", "64n", Tone.now(), 0.01);
            }
        }

        function playWinSound() {
            // Cheerful, rising notes
            const now = Tone.now();
            synth.triggerAttackRelease("C5", "8n", now);
            synth.triggerAttackRelease("E5", "8n", now + 0.1);
            synth.triggerAttackRelease("G5", "8n", now + 0.2);
            synth.triggerAttackRelease("C6", "4n", now + 0.3);
        }

        function playLoseSound() {
            // Low, dissonant tone
            synth.triggerAttackRelease(["C3", "B2"], "4n", Tone.now(), 0.5);
        }
        
        // --- CONFETTI LOGIC ---
        const confettiColors = ['c-red', 'c-green', 'c-white'];

        function launchConfetti() {
            // Remove old confetti elements
            confettiContainer.innerHTML = ''; 

            const rect = gameContainer.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;

            for (let i = 0; i < 50; i++) {
                const confetto = document.createElement('div');
                
                // Assign random color class
                const color = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                confetto.className = `confetto ${color}`;

                // Randomize starting position around the center
                const startX = centerX + (Math.random() - 0.5) * rect.width * 0.5;
                const startY = centerY + (Math.random() - 0.5) * rect.height * 0.5;
                
                confetto.style.left = `${startX}px`;
                confetto.style.top = `${startY}px`;
                
                // Slightly randomize animation delay and duration for a scattered look
                const delay = Math.random() * 0.5;
                const duration = 2.5 + Math.random() * 1.5;
                
                confetto.style.animationDelay = `${delay}s`;
                confetto.style.animationDuration = `${duration}s`;
                
                confettiContainer.appendChild(confetto);
            }
            
            // Cleanup confetti after animation ends
            setTimeout(() => {
                confettiContainer.innerHTML = '';
            }, 4000);
        }


        // --- GAME CORE LOGIC ---

        function calculateOverlap() {
            const rectH = wordH.getBoundingClientRect();
            const rectV = wordV.getBoundingClientRect();

            const intersectX1 = Math.max(rectH.left, rectV.left);
            const intersectY1 = Math.max(rectH.top, rectV.top);
            const intersectX2 = Math.min(rectH.right, rectV.right);
            const intersectY2 = Math.min(rectH.bottom, rectV.bottom);

            const overlapWidth = intersectX2 - intersectX1;
            const overlapHeight = intersectY2 - intersectY1;

            const areaOverlap = (overlapWidth > 0 && overlapHeight > 0)
                ? overlapWidth * overlapHeight
                : 0;

            const targetArea = rectV.width * rectV.height;

            let percentage = 0;
            if (targetArea > 0) {
                percentage = (areaOverlap / targetArea) * 100;
            }

            return Math.min(100, percentage);
        }

        function gameLoop(timestamp) {
            if (!isMoving) {
                return;
            }

            const timeFactor = timestamp * speed;

            // Horizontal word (CHRISTMAS) movement: Left/Right
            const containerWidth = gameContainer.offsetWidth - wordH.offsetWidth;
            if (containerWidth > 0) {
                posH = Math.cos(timeFactor) * 0.5 + 0.5; 
                wordH.style.left = `${posH * containerWidth}px`;
            }

            // Vertical word (CHRISTMAS) movement: Up/Down
            const containerHeight = gameContainer.offsetHeight - wordV.offsetHeight;
             if (containerHeight > 0) {
                posV = Math.sin(timeFactor * 0.8) * 0.5 + 0.5; 
                wordV.style.top = `${posV * containerHeight}px`;
            }

            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function resetGame() {
            isGameRunning = true;
            isMoving = false;
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }

            // Reset positions
            wordH.style.left = '0px';
            wordV.style.top = '0px';
            posH = 0;
            posV = 0;

            // Reset UI
            stopButton.textContent = 'START';
            stopButton.onclick = startGame;
            scoreDisplay.textContent = 'Overlap: 0.00%';
            resultDisplay.classList.add('show-result');
            resultMessage.textContent = 'Press START to align the words!';
            resultDisplay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
        }

        function startGame() {
            if (!isGameRunning) return;
            
            // Start the Tone.js audio context on the first click
            startAudioContext();

            isMoving = true;
            resultDisplay.classList.remove('show-result');
            stopButton.textContent = 'STOP!';
            stopButton.onclick = stopGame;

            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function stopGame() {
            if (!isMoving || !isGameRunning) return;

            isMoving = false;
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }

            // 1. Calculate Score
            const overlapPercent = calculateOverlap();
            scoreDisplay.textContent = `Overlap: ${overlapPercent.toFixed(2)}%`;

            // 2. Determine Result
            const WIN_THRESHOLD = 90;

            if (overlapPercent >= WIN_THRESHOLD) {
                resultMessage.textContent = `PERFECT ALIGNMENT! You hit ${overlapPercent.toFixed(2)}% overlap!`;
                resultDisplay.style.backgroundColor = 'rgba(0, 128, 0, 0.8)'; // Green for Win
                playWinSound();
                launchConfetti(); // Trigger confetti!
            } else {
                const required = (WIN_THRESHOLD - overlapPercent).toFixed(2);
                resultMessage.textContent = `MISSED IT! Only ${overlapPercent.toFixed(2)}% overlap. Try to get ${required}% closer.`;
                resultDisplay.style.backgroundColor = 'rgba(204, 0, 0, 0.8)'; // Red for Loss
                playLoseSound();
            }

            // 3. Update UI for next round
            resultDisplay.classList.add('show-result');
            stopButton.textContent = 'PLAY AGAIN';
            stopButton.onclick = resetGame;
            isGameRunning = false;
        }

        // --- INITIALIZATION ---

        window.onload = resetGame;

    </script>
</body>
</html>